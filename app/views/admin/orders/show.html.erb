<!--（管理者）注文履歴詳細-->
<main>
  <div class = "container-fluid" style = "margin-top: 40px">
    <div class = "row">
      <div class = "offset-1 h3">
        <div style = "background-color: #EEEEEE; text-align: center; padding: 0 20px">注文履歴一覧</div>
      </div>
    </div>
    <div class = "row">
      <table class = "table table-borderless offset-1">
        <tr>
          <th class = "col-1">購入者</th>
          <td class = "col-2">
            <%= link_to admin_customer_path(id = @order.customer.id) do %>
              <u class = "text-dark"><%= @order.customer.last_name %> <%= @order.customer.first_name %></u>
            <% end %>
          </td>
        </tr>
        <tr>
          <th class = "col-1">注文日</th>
          <td class = "col-2"><%= @order.created_at.strftime('%Y/%m/%d') %></td>
        </tr>
        <tr>
          <th class = "col-1">配送先</th>
          <td colspan = "5">〒<%= @order.shipping_postal_code %> <%= @order.shipping_address %><br><%= @order.shipping_name %></td>
        </tr>
        <tr>
          <th class = "col-1">支払方法</th>
          <td class = "col-2"><%= @order.payment_method_i18n %></td>
        </tr>
        <tr>
          <th class = "col-1">注文ステータス</th>
          <%= form_with model: @order, url: admin_order_path(id = @order.id), method: :patch do |f| %>
            <td colspan = "1">
              <%= f.select :status, Order.statuses.keys.map {|k| [I18n.t("enums.order.status.#{k}"), k]}, {}, {class: "form-control"} %>
            </td>
            <td>
              <%= f.submit '更新', class: "btn btn-success" %>
            </td>
          <% end %>
          <td class = "col-10"></td>
        </tr>
      </table>
    </div>
    <div class = "row">
      <div class = "col-8 offset-1">
        <table class = "table table-borderless border-top border-bottom">
          <thead>
            <tr bgcolor = "#EEEEEE">
              <th class = "col-3">商品名</th>
              <th class = "col-1">単価(税込)</th>
              <th class = "col-1">数量</th>
              <th class = "col-1">小計</th>
              <th colspan = "2">製作ステータス</th>
            </tr>
          </thead>
          <tbody>
            <% @order.order_details.each do |order_detail| %>
              <tr>
                <td class = "col-3"><%= order_detail.item.name %></td>
                <td class = "col-1"><%= order_detail.purchase_price.to_s(:delimited) %></td>
                <td class = "col-1"><%= order_detail.amount %></td>
                <td class = "col-1"><%= (order_detail.purchase_price * order_detail.amount).to_s(:delimited) %></td>
                <!--【エラー】admin/orders/admin/:order_id/order_details/:id　と"orders/"の後ろに何故かもう一度"admin"が出てエラーになっているみたい-->
                <%= form_with model: order_detail, url: "#{order_detail.order_id}/order_details/#{order_detail.id}", method: :patch do |f| %>
                  <td class = "col-1">
                    <%= f.select :making_status, OrderDetail.making_statuses.keys.map {|k| [I18n.t("enums.order_detail.making_status.#{k}"), k]}, {}, {class: "form-control"} %>
                  </td>
                  <td class = "col-1">
                    <%= f.submit '更新', class: "btn btn-success" %>
                  </td>
                <% end %>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <div class = "col-2 d-flex align-items-end" style = "margin-left: 40px">
        <table class = "table table-borderless">
          <tr>
            <th scope = "col" style = "width:25%">商品合計</th>
            <td scope = "col" class = "text-right" style = "width:20%"><%= (@order.total_price - @order.shipping_price).to_s(:delimited) %>円</td>
            <td scope = "col" style = "width:10%"></td>
          </tr>
          <tr>
            <th>送料</th>
            <td class = "text-right"><%= @order.shipping_price.to_s(:delimited) %>円</td>
          </tr>
          <tr>
            <th>請求金額合計</th>
            <td class = "text-right"><%= @order.total_price.to_s(:delimited) %>円</td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</main>